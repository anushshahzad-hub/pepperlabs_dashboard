<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pepper Labs â€“ Workflow Command Center</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="min-h-screen bg-gray-100">

  <!-- Header -->
  <header class="bg-white border-b shadow-sm sticky top-0 z-10">
    <div class="max-w-[1440px] mx-auto px-8 py-6 flex items-center gap-4">
      <div class="w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center">
        <i data-lucide="layers" class="w-6 h-6 text-white"></i>
      </div>
      <div>
        <h1 class="text-2xl font-bold text-gray-900">Pepper Labs</h1>
        <p class="text-sm text-gray-500">Workflow Command Center</p>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-[1440px] mx-auto px-8 py-10">

    <!-- Workflow Status Cards -->
    <section class="grid grid-cols-3 gap-6 mb-12">
      <div class="bg-gray-400 text-white rounded-xl p-6">
        <p class="text-sm uppercase opacity-80">Active</p>
        <p class="text-xs opacity-70">Approved</p>
        <p class="text-4xl font-bold mt-4"><span id="activeApproved">0</span></p>
      </div>

        <p class="text-sm uppercase opacity-80">Non-Active</p>
        <p class="text-xs opacity-70">Approved</p>
        <p class="text-4xl font-bold mt-4"><span id="nonActiveApproved">0</span></p>
      </div>

      <div class="bg-gray-400 text-white rounded-xl p-6">
        <p class="text-sm uppercase opacity-80">New Leads</p>
        <p class="text-4xl font-bold mt-6"><span id="newLeads">0</span></p>
      </div>
    </section>

    <!-- Lead & Account Workflow -->
    <section class="bg-white rounded-xl shadow p-6 mb-12">
      <h2 class="text-xl font-bold mb-1">Lead & Account Workflow</h2>
      <p class="text-sm text-gray-500 mb-6">
        A categorized view of all leads and accounts in this project.
      </p>

      <div class="space-y-3">
        <div class="flex justify-between items-center border rounded-lg px-4 py-3 bg-gray-50">
          <span class="font-medium">Leads</span>
          <span class="text-sm text-gray-600" id="leadsCount">0</span>
        </div>

        <div class="flex justify-between items-center border rounded-lg px-4 py-3 bg-gray-50">
          <span class="font-medium">Ongoing</span>
          <span class="text-sm text-gray-600" id="ongoingCount">0</span>
        </div>

        <div class="flex justify-between items-center border rounded-lg px-4 py-3 bg-gray-50">
          <span class="font-medium">Active</span>
          <span class="text-sm text-gray-600" id="activeCount">0</span>
        </div>

        <div class="flex justify-between items-center border rounded-lg px-4 py-3 bg-gray-50">
          <span class="font-medium">Rejected</span>
          <span class="text-sm text-gray-600" id="rejectedCount">0</span>
        </div>
      </div>
    </section>

    <!-- Exceptions & Risks -->
    <section>
      <h2 class="text-xl font-bold mb-6">Exceptions & Risks</h2>

      <div class="grid grid-cols-4 gap-6">
        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-yellow-400">
          <h3 class="font-semibold">Not Contacted (48h)</h3>
          <p class="text-2xl font-bold mt-3" id="notContacted">0</p>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-red-500">
          <h3 class="font-semibold">Incomplete Documents</h3>
          <p class="text-2xl font-bold mt-3" id="incompleteDocs">0</p>
        </div>
      </div>
    </section>

  </main>

  <!-- Icons -->
  <script>
    lucide.createIcons();
  </script>

  <!-- Data Integration -->
  <script>
    const SHEET_ID = "1njDM4qZcdPoyIeGGnWrZUUTTXsoO9BWo0GKrHTkYv58";
    const SHEET_NAME = "Outreach Status"; // change if needed

    const URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}`;

    fetch(URL)
      .then(res => res.text())
      .then(text => {
        const json = JSON.parse(text.substr(47).slice(0, -2));
        const rows = json.table.rows;

        let data = {
          activeApproved: 0,
          nonActiveApproved: 0,
          newLeads: 0,
          leads: 0,
          ongoing: 0,
          active: 0,
          rejected: 0,
          notContacted: 0,
          incompleteDocs: 0
        };

        rows.forEach(row => {
          const status = row.c[2]?.v?.toLowerCase();      // Status
          const approved = row.c[6]?.v?.toLowerCase();    // Approved
          const nextStep = row.c[10]?.v;                  // Next Step
          const statusUpdate = row.c[9]?.v;               // Status Update

          if (status === "active" && approved === "yes") data.activeApproved++;
          if (status === "non-active" && approved === "yes") data.nonActiveApproved++;
          if (status === "new") data.newLeads++;

          if (status === "new") data.leads++;
          if (status === "ongoing") data.ongoing++;
          if (status === "active") data.active++;
          if (status === "rejected") data.rejected++;

          if (!nextStep) data.incompleteDocs++;
          if (!statusUpdate) data.notContacted++;
        });

        // Bind to UI
        activeApproved.innerText = data.activeApproved;
        nonActiveApproved.innerText = data.nonActiveApproved;
        newLeads.innerText = data.newLeads;

        leadsCount.innerText = data.leads;
        ongoingCount.innerText = data.ongoing;
        activeCount.innerText = data.active;
        rejectedCount.innerText = data.rejected;

        notContacted.innerText = data.notContacted;
        incompleteDocs.innerText = data.incompleteDocs;
      });
  </script>

</body>
</html>
